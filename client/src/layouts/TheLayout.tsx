import React, { ReactNode, FC, useEffect, useState } from "react";
import { useRouter } from "next/router";
import Head from "next/head";
import Link from "next/link";
import { Layout, Menu } from "antd";

const { Header, Content } = Layout;

type Props = {
  children: ReactNode;
};

const urlToTitle: Readonly<Record<string, string>> = Object.freeze({
  "/": "Exploitable App",
  "/asiv": "Asiv",
  "/flora": "Flora",
  "/flora/login": "Flora | Login",
});

const TheLayout: FC<Props> = ({ children }): JSX.Element => {
  const router = useRouter();
  const [selectedMenuKeys, setSelectedMenuKeys] = useState<string[]>([]);

  useEffect(() => {
    // regex to get first URL path segment
    const selectedMenuKeys = router.pathname.match(/^\/[^\/]*/g);
    setSelectedMenuKeys(selectedMenuKeys ?? []);
  }, [router.pathname]);

  // TODO: add indicator for logged in user
  return (
    <>
      <Head>
        <title>{urlToTitle[router.pathname] ?? urlToTitle["/"]}</title>
        <meta charSet="utf-8" />
        <meta name="viewport" content="initial-scale=1.0, width=device-width" />
      </Head>
      <Layout style={{ minHeight: "100vh" }}>
        {/* TOP NAV */}
        <Header>
          <Menu
            mode="horizontal"
            theme="dark"
            style={{ fontSize: "17px" }}
            selectedKeys={selectedMenuKeys}
          >
            <Menu.Item key="/">
              <Link href="/">Main</Link>
            </Menu.Item>
            <Menu.Item key="/flora">
              <Link href="/flora">Flora</Link>
            </Menu.Item>
            <Menu.Item key="/asiv">
              <Link href="/asiv">Asiv</Link>
            </Menu.Item>
          </Menu>
        </Header>

        {/* PAGE */}
        <Content style={{ padding: "1rem" }}>{children}</Content>

        {/* BOTTOM NAV */}
        {/* <Footer style={{ textAlign: "center" }}>This is the footer</Footer> */}
      </Layout>
    </>
  );
};

export default TheLayout;
