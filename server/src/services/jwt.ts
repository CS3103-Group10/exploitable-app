import jwt from "jsonwebtoken";
import { Request, Response, NextFunction } from "express";

import { HttpStatusCode } from "./../utils";

function verifyToken(req: Request, res: Response, next: NextFunction) {
  if (req.headers.authorization !== undefined) {
    const bearerHeader = req.headers.authorization;
    const bearer = bearerHeader.split(" ");
    const bearerToken = bearer[1];
    if (bearerToken != null) {
      jwt.verify(bearerToken, "secretkey", (err: any, user: any) => {
        if (err) res.status(HttpStatusCode.FORBIDDEN);
        req.body.user = user;
        next();
      });
    }
  }
  res.status(HttpStatusCode.FORBIDDEN);
}

export { jwt, verifyToken };
